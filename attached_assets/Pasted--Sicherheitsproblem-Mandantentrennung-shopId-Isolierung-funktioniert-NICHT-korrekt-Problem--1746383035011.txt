ğŸš¨ Sicherheitsproblem: Mandantentrennung (shopId-Isolierung) funktioniert NICHT korrekt

Problem:
â†’ Normale Benutzer (also **nicht Admins**) kÃ¶nnen **alle Kunden- und ReparaturauftrÃ¤ge sehen**, auch von anderen Shops  
â†’ Das **verstÃ¶ÃŸt gegen die DSGVO** und muss dringend behoben werden

Bitte behebe das jetzt vollstÃ¤ndig und konsequent:

---

âœ… Ziel:
- Jeder Benutzer darf **nur Daten sehen**, die zu seinem eigenen Shop gehÃ¶ren (shopId)
- Es gibt **keine Ausnahmen** â€“ auch **Admin "bugi" darf nur seinen Shop sehen**
- Alle Datenbankabfragen (select, insert, update, delete) mÃ¼ssen korrekt gefiltert werden

---

ğŸ” Aufgaben:

1. **ÃœberprÃ¼fe alle Methoden in `server/storage.ts`**, speziell:
   - `getAllCustomers`, `getCustomer`
   - `getAllRepairs`, `getRepair`, `getRepairsByCustomerId`
   - `getStats`, `getDetailedRepairStats`
   - `updateRepair`, `deleteRepair`
   - `getAllCostEstimates`, `getCostEstimate`, `createRepairFromEstimate`
   - `getAllUsers` usw.

   â†’ Dort **immer prÃ¼fen, ob `.where(eq(table.shopId, user.shopId))` korrekt gesetzt ist**  
   â†’ Auch bei Updates und Deletes muss `shopId` im Filter enthalten sein

2. **Stelle sicher, dass `req.user.shopId` korrekt gesetzt und verfÃ¼gbar ist**
   - PrÃ¼fe die Session / JWT oder den Auth-Wrapper

3. **Entferne alle Bedingungen wie**:
   ```ts
   if (user.isAdmin) {
     // bypass
   }
   ```
   â†’ So etwas darf es **nicht mehr geben** â€“ Admins dÃ¼rfen keinen globalen Zugriff haben

4. **Log-Ausgabe prÃ¼fen**
   - FÃ¼ge z.â€¯B. in `getAllCustomers()` hinzu:
     ```ts
     console.log("ğŸ”’ Aktiver shopId-Filter:", user.shopId);
     ```

5. **ÃœberprÃ¼fe beim Erstellen von Kunden, Reparaturen, KostenvoranschlÃ¤gen etc., ob `shopId` korrekt gespeichert wird**

---

ğŸ§ª SQL-Kontrolle:

FÃ¼hre in deiner Datenbank folgenden Befehl aus, um inkonsistente Daten zu finden:

```sql
-- Finde Kunden ohne shopId
SELECT id, first_name, last_name FROM customers WHERE shop_id IS NULL;

-- Finde Reparaturen ohne shopId
SELECT id, device_name FROM repairs WHERE shop_id IS NULL;

-- Finde KostenvoranschlÃ¤ge ohne shopId
SELECT id, title FROM cost_estimates WHERE shop_id IS NULL;
```

â†’ Wenn hier EintrÃ¤ge erscheinen, wurden Daten ohne gÃ¼ltigen shopId gespeichert â€“ das muss korrigiert werden

---

ğŸ“Œ Wichtig:
- Diese SicherheitslÃ¼cke ist DSGVO-relevant â€“ bitte hÃ¶chste PrioritÃ¤t
- Nach Abschluss: Mit 2 Benutzern (verschiedene Shops) einloggen und prÃ¼fen: **sehen sie wirklich NUR ihre eigenen Daten?**

Bitte setze das jetzt vollstÃ¤ndig und sauber um. Danke!
