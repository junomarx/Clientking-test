import { QRCodeSVG } from "qrcode.react";

// --- Print-sicheres Querformat-Etikett 57 × 32 mm ---
// Hauptprobleme im bisherigen Code:
// 1) Feste Pixelmaße (220×120px) → auf Druckern skaliert das oft falsch.
// 2) Kein @page size → Browser fügt Seitenränder/Skalierung hinzu.
// 3) Gerätemodell kam leer, weil "repair.model" nicht gesetzt war.
// 4) QR/Typo-Schärfe: besser mm verwenden und Print-Styles anwenden.

// Lösung: echte mm‑Maße + @page + saubere Flex-Struktur + Modell-Fallback

export default function Label572x32() {
  // Demo‑Daten; ersetze diese durch deine Variablen
  const repair = {
    orderCode: "AS252375",
    // Falls du nur eines der Felder befüllst, greift der Fallback unten
    device: "Apple iPhone 13", // Gerätemodell (voll)
    model: "iPhone 13",        // Gerätemodell (kurz)
    issue: "keine Reaktion\nTasten lassen sich nicht drücken",
  };
  const customer = {
    firstName: "Max",
    lastName: "Mustermann",
    phone: "012345678",
  };
  const deviceCode = "Code: 020304";
  const qrValue = `${window.location.origin}/repairs/${repair.orderCode}`;

  // Anzeigepräferenz fürs Gerätemodell: zuerst "device", sonst "model"
  const deviceLabel = repair.device || repair.model || "";

  return (
    <div className="min-h-screen w-full flex items-center justify-center bg-neutral-100 p-6">
      {/* Print CSS inline, damit es auch in Canvas greift */}
      <style>{`
        @page { size: 57mm 32mm; margin: 0; }
        @media print {
          html, body { margin: 0; padding: 0; }
          #label-57x32 { width: 57mm; height: 32mm; box-shadow: none; border: 0; }
        }
      `}</style>

      {/* Etikett-Rahmen in mm, nicht px */}
      <div
        id="label-57x32"
        style={{ width: "57mm", height: "32mm", padding: "2mm" }}
        className="bg-white border border-gray-300 rounded-md shadow-sm box-border flex"
      >
        {/* Linke Spalte: Auftragsnr. oben, QR unten/zentriert */}
        <div style={{ width: "28mm" }} className="flex flex-col">
          <div className="font-bold leading-none mb-[1mm] truncate" style={{ fontSize: 14 }}>
            {repair.orderCode}
          </div>
          <div className="flex items-start">
            <QRCodeSVG value={qrValue} size={72} level="M" />
            {/* 72px ≈ 19mm, Druck erfolgt über @page ohne Skalierung */}
          </div>
        </div>

        {/* Rechte Spalte: Kunde → Code → Modell → Fehler */}
        <div className="flex-1 pl-[2mm] flex flex-col">
          <div className="flex justify-end text-right leading-tight">
            <div>
              <div className="font-bold text-[13px] leading-none truncate">
                {customer.firstName} {customer.lastName}
              </div>
              <div className="text-[11px] text-gray-500 leading-none truncate">
                {customer.phone || ""}
              </div>
            </div>
          </div>

          {/* Gerätecode als Pill */}
          <div className="flex justify-center py-[1mm]">
            <div className="inline-block border border-gray-400 rounded-2xl px-2 py-[1mm] font-semibold text-[11px] leading-none">
              {deviceCode}
            </div>
          </div>

          {/* Gerätemodell (eindeutig) */}
          <div className="text-center font-bold text-[13px] leading-tight truncate">
            {deviceLabel}
          </div>

          {/* Fehlerbeschreibung */}
          <div className="text-center text-[11px] leading-tight whitespace-pre-line">
            {repair.issue || ""}
          </div>
        </div>
      </div>
    </div>
  );
}
